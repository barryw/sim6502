suites {
  suite("Test Suite 15 - test options") {
    symbols("TestPrograms/include_me_full.sym")
    load("TestPrograms/include_me_full.prg", strip_header = true)

    ; Test 1: skip = true should skip test execution
    test("skip-true", "Test with skip = true should be skipped", skip = true) {
      jsr([FillMemory], stop_on_rts = true)
      assert(false, "This assertion should never execute because test is skipped")
    }

    ; Test 2: skip = false should run normally (explicit false)
    test("skip-false", "Test with skip = false should run normally", skip = false) {
      jsr([FillMemory], stop_on_rts = true)
      assert(true, "This test should execute normally")
    }

    ; Test 3: trace = true should enable execution trace on failure
    test("trace-true", "Test with trace = true (will pass)", trace = true) {
      jsr([FillMemory], stop_on_rts = true)
      assert(true, "This passes so no trace output expected")
    }

    ; Test 4: trace = false (explicit)
    test("trace-false", "Test with trace = false", trace = false) {
      jsr([FillMemory], stop_on_rts = true)
      assert(true, "This test runs without trace")
    }

    ; Test 5: timeout = N sets cycle limit
    test("timeout-value", "Test with timeout = 10000", timeout = 10000) {
      jsr([FillMemory], stop_on_rts = true)
      assert(true, "Test completes within timeout")
    }

    ; Test 6: tags = "a,b" for categorization
    test("tags-single", "Test with single tag", tags = "smoke") {
      jsr([FillMemory], stop_on_rts = true)
      assert(true, "Test with smoke tag")
    }

    ; Test 7: Multiple tags
    test("tags-multiple", "Test with multiple tags", tags = "integration,regression") {
      jsr([FillMemory], stop_on_rts = true)
      assert(true, "Test with integration and regression tags")
    }

    ; Test 8: Combining multiple options
    test("combined-options", "Test with multiple options combined",
         trace = true, timeout = 50000, tags = "comprehensive") {
      jsr([FillMemory], stop_on_rts = true)
      assert(true, "Test with trace, timeout, and tags")
    }

    ; Test 9: All options together
    test("all-options", "Test with all available options",
         skip = false, trace = true, timeout = 100000, tags = "full,test") {
      jsr([FillMemory], stop_on_rts = true)
      assert(true, "Test with all options specified")
    }

    ; Test 10: No options - backward compatibility
    test("no-options", "Test without any options for backward compatibility") {
      jsr([FillMemory], stop_on_rts = true)
      assert(true, "Test runs normally without any options")
    }

    ; Test 11: Empty tags
    test("tags-empty", "Test with empty tags", tags = "") {
      jsr([FillMemory], stop_on_rts = true)
      assert(true, "Test with empty tags string")
    }

    ; Test 12: Large timeout value
    test("timeout-large", "Test with large timeout", timeout = 1000000) {
      jsr([FillMemory], stop_on_rts = true)
      assert(true, "Test with large timeout value")
    }

    ; Test 13: Zero timeout (should use default or unlimited)
    test("timeout-zero", "Test with timeout = 0", timeout = 0) {
      jsr([FillMemory], stop_on_rts = true)
      assert(true, "Test with zero timeout")
    }

    ; Test 14: Complex tag names with underscores and numbers
    test("tags-complex", "Test with complex tag names", tags = "test_123,feature_abc,bug_fix_456") {
      jsr([FillMemory], stop_on_rts = true)
      assert(true, "Test with complex tag naming")
    }

    ; Test 15: Mixed options in different order
    test("option-order", "Options specified in different order",
         tags = "order", timeout = 75000, trace = false, skip = false) {
      jsr([FillMemory], stop_on_rts = true)
      assert(true, "Option order should not matter")
    }
  }

  suite("Test Suite 15b - test options edge cases") {
    symbols("TestPrograms/include_me_full.sym")
    load("TestPrograms/include_me_full.prg", strip_header = true)

    ; Test with only skip option
    test("only-skip", "Test with only skip option", skip = false) {
      jsr([FillMemory], stop_on_rts = true)
      assert(true, "Only skip option specified")
    }

    ; Test with only trace option
    test("only-trace", "Test with only trace option", trace = true) {
      jsr([FillMemory], stop_on_rts = true)
      assert(true, "Only trace option specified")
    }

    ; Test with only timeout option
    test("only-timeout", "Test with only timeout option", timeout = 20000) {
      jsr([FillMemory], stop_on_rts = true)
      assert(true, "Only timeout option specified")
    }

    ; Test with only tags option
    test("only-tags", "Test with only tags option", tags = "isolated") {
      jsr([FillMemory], stop_on_rts = true)
      assert(true, "Only tags option specified")
    }

    ; Test combining skip and tags (skipped test can still have tags)
    test("skip-with-tags", "Skipped test with tags", skip = true, tags = "skipped,wip") {
      jsr([FillMemory], stop_on_rts = true)
      assert(false, "Should not execute - test is skipped")
    }

    ; Test combining skip and trace (should not trace if skipped)
    test("skip-with-trace", "Skipped test with trace", skip = true, trace = true) {
      jsr([FillMemory], stop_on_rts = true)
      assert(false, "Should not execute - test is skipped")
    }

    ; Test combining skip and timeout (timeout irrelevant if skipped)
    test("skip-with-timeout", "Skipped test with timeout", skip = true, timeout = 1000) {
      jsr([FillMemory], stop_on_rts = true)
      assert(false, "Should not execute - test is skipped")
    }
  }

  suite("Test Suite 15c - test options with symbols") {
    symbols("TestPrograms/include_me_full.sym")
    load("TestPrograms/include_me_full.prg", strip_header = true)

    ; Use symbols in test body with options
    test("options-with-symbols", "Test options work with symbol references",
         trace = true, tags = "symbols") {
      ; Use various symbol types
      $5000 = $42
      [r0L] = $11
      [r0H] = $22
      [vic.EXTCOL] = $0e

      jsr([FillMemory], stop_on_rts = true)

      assert($5000 == $42, "Direct address assignment works")
      assert([r0L] == $11, "Symbol dereference works")
      assert([vic.EXTCOL] == $0e, "Namespaced symbol works")
    }

    ; Test timeout with actual cycles consumed
    test("timeout-realistic", "Test with realistic timeout and cycle consumption",
         timeout = 500000, tags = "performance") {
      ; Fill some memory which consumes cycles
      memfill($6000, 256, $ff)

      jsr([FillMemory], stop_on_rts = true)

      assert($6000 == $ff, "Memfill completed within timeout")
    }

    ; Test with setup block and options
    setup {
      $7000 = $aa
      [r0L] = $33
    }

    test("options-with-setup", "Test options work with setup block",
         trace = false, timeout = 100000, tags = "setup") {
      ; Verify setup ran
      assert($7000 == $aa, "Setup ran before test")
      assert([r0L] == $33, "Setup initialized symbols")

      jsr([FillMemory], stop_on_rts = true)
      assert(true, "Test with setup and options completed")
    }
  }
}
